<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cliente em Foco</title>
<style>
  body { font-family: Arial, sans-serif; background-color: #f3f4f6; margin: 0; padding: 0; }
  header { background-color: #2563eb; color: white; padding: 1rem; text-align: center; font-size: 1.5rem; }
  main { display: flex; justify-content: space-around; padding: 1rem; }
  .column { width: 30%; background-color: #e5e7eb; border-radius: 10px; padding: 10px; min-height: 400px; }
  .column h2 { text-align: center; margin-bottom: 5px; }
  .column p { font-size: 0.8rem; color: #555; margin-bottom: 10px; text-align: center; }
  .card { background-color: white; border-radius: 10px; padding: 10px; margin-bottom: 10px; cursor: grab; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  .card:hover { background-color: #f9fafb; }
  .card-block { background-color: #f9fafb; padding: 5px; border-radius: 5px; margin-bottom: 5px; }
  .card-tags span { background-color: #e5e7eb; padding: 2px 5px; border-radius: 3px; margin-right: 3px; font-size: 0.75rem; }
  #newClientBtn { margin: 10px; padding: 10px 15px; background-color: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer; }
  #newClientBtn:hover { background-color: #1d4ed8; }
  #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; }
  #modalContent { background: white; padding: 20px; border-radius: 10px; width: 300px; max-height: 90%; overflow-y: auto; }
  label { display: block; margin-top: 10px; }
  input, select, textarea { width: 100%; padding: 5px; border-radius: 5px; border: 1px solid #ccc; }
  .delete-btn { background-color: #dc2626; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
  .delete-btn:hover { background-color: #b91c1c; }
</style>
</head>
<body>
<header>Cliente em Foco</header>
<button id="newClientBtn">+ Novo Cliente</button>

<main>
  <div class="column" id="risco" ondrop="drop(event)" ondragover="allowDrop(event)">
    <h2>‚ö†Ô∏è Risco de Cancelamento</h2>
    <p>Clientes que podem cancelar por pend√™ncias ou erros</p>
  </div>
  <div class="column" id="critico" ondrop="drop(event)" ondragover="allowDrop(event)">
    <h2>‚ùó Cr√≠tico</h2>
    <p>Clientes dif√≠ceis de lidar, com risco de conflito</p>
  </div>
  <div class="column" id="duvidas" ondrop="drop(event)" ondragover="allowDrop(event)">
    <h2>‚ÑπÔ∏è D√∫vidas</h2>
    <p>Clientes com d√∫vidas ou implanta√ß√£o incompleta</p>
  </div>
</main>

<div id="modal">
  <div id="modalContent">
    <h3 id="modalTitle">Novo Cliente</h3>
    <label>Nome da Organiza√ß√£o</label>
    <input type="text" id="clientName">

    <label>Integrantes</label>
    <input type="text" id="clientMembers">

    <label>Data de In√≠cio</label>
    <input type="date" id="startDate">

    <label>Data Final</label>
    <input type="date" id="endDate">

    <label>Tickets</label>
    <textarea id="tickets"></textarea>

    <label>Houve diverg√™ncia comercial?</label>
    <select id="divergenciaComercial">
      <option value="">Selecione</option>
      <option value="Sim">Sim</option>
      <option value="N√£o">N√£o</option>
    </select>

    <label>Teve sistema anterior?</label>
    <select id="sistemaanterior">
      <option value="">Selecione</option>
      <option value="Sim">Sim</option>
      <option value="N√£o">N√£o</option>
    </select>

    <label>Houve atraso na implanta√ß√£o?</label>
    <select id="atrasoImplantacao">
      <option value="">Selecione</option>
      <option value="Sim">Sim</option>
      <option value="N√£o">N√£o</option>
    </select>

    <label>Quem foi o implantador?</label>
    <input type="text" id="implantador">

    <label>Observa√ß√µes</label>
    <textarea id="observacoes"></textarea>

    <label>Trativa</label>
    <textarea id="trativa"></textarea>

    <button type="button" id="saveBtn">Salvar</button>
    <button type="button" onclick="closeModal()">Cancelar</button>
  </div>
</div>

<script>
let draggedItem = null;
let clients = JSON.parse(localStorage.getItem('clients')) || [];
let editingId = null;

function allowDrop(ev) { ev.preventDefault(); }
function drag(ev) { draggedItem = ev.target; }
function drop(ev) {
  ev.preventDefault();
  const column = ev.target.closest('.column');
  if (column && draggedItem) {
    column.appendChild(draggedItem);
    const clientId = draggedItem.dataset.id;
    const client = clients.find(c => c.id == clientId);
    client.column = column.id;
    saveLocal();
  }
}

document.getElementById('newClientBtn').addEventListener('click', () => openModal());
document.getElementById('saveBtn').addEventListener('click', saveClient);

function openModal(client = null) {
  document.getElementById('modal').style.display = 'flex';
  editingId = client ? client.id : null;
  document.getElementById('modalTitle').innerText = client ? 'Editar Cliente' : 'Novo Cliente';
  document.getElementById('clientName').value = client ? client.name : '';
  document.getElementById('clientMembers').value = client ? client.members : '';
  document.getElementById('startDate').value = client ? client.start : '';
  document.getElementById('endDate').value = client ? client.end : '';
  document.getElementById('tickets').value = client ? client.tickets : '';
  document.getElementById('divergenciaComercial').value = client ? client.divergenciaComercial : '';
  document.getElementById('sistemaanterior').value = client ? client.sistemaanterior : '';
  document.getElementById('atrasoImplantacao').value = client ? client.atrasoImplantacao : '';
  document.getElementById('implantador').value = client ? client.implantador : '';
  document.getElementById('observacoes').value = client ? client.observacoes : '';
  document.getElementById('trativa').value = client ? client.trativa : '';
}

function closeModal() {
  document.getElementById('modal').style.display = 'none';
  editingId = null;
}

function saveClient() {
  const name = document.getElementById('clientName').value.trim();
  if (!name) { alert('Preencha o nome da organiza√ß√£o'); return; }

  const clientData = {
    name: name,
    members: document.getElementById('clientMembers').value,
    start: document.getElementById('startDate').value,
    end: document.getElementById('endDate').value,
    tickets: document.getElementById('tickets').value,
    divergenciaComercial: document.getElementById('divergenciaComercial').value,
    sistemaanterior: document.getElementById('sistemaanterior').value,
    atrasoImplantacao: document.getElementById('atrasoImplantacao').value,
    implantador: document.getElementById('implantador').value,
    observacoes: document.getElementById('observacoes').value,
    trativa: document.getElementById('trativa').value,
    column: 'duvidas'
  };

  if (editingId) {
    const clientIndex = clients.findIndex(c => c.id == editingId);
    if (clientIndex > -1) {
      clientData.id = editingId;
      clients[clientIndex] = clientData;
    }
  } else {
    clientData.id = Date.now();
    clients.push(clientData);
  }

  saveLocal();
  renderClients();
  closeModal();
}

function deleteClient(id) {
  if(confirm('Tem certeza que deseja excluir este cliente?')) {
    clients = clients.filter(c => c.id !== id);
    saveLocal();
    renderClients();
  }
}

function saveLocal() {
  localStorage.setItem('clients', JSON.stringify(clients));
}

function renderClients() {
  const colNames = {
    risco: '‚ö†Ô∏è Risco de Cancelamento',
    critico: '‚ùó Cr√≠tico',
    duvidas: '‚ÑπÔ∏è D√∫vidas'
  };
  const colDescriptions = {
    risco: 'Clientes que podem cancelar por pend√™ncias ou erros',
    critico: 'Clientes dif√≠ceis de lidar, com risco de conflito',
    duvidas: 'Clientes com d√∫vidas ou implanta√ß√£o incompleta'
  };

  ['risco','critico','duvidas'].forEach(col => {
    const columnEl = document.getElementById(col);
    columnEl.innerHTML = `<h2>${colNames[col]}</h2><p>${colDescriptions[col]}</p>`;
  });

  clients.forEach(client => {
    const card = document.createElement('div');
    card.className = 'card';
    card.draggable = true;
    card.dataset.id = client.id;
    card.ondragstart = drag;
    card.onclick = () => openModal(client);

    let tagsHtml = '';
    if(client.divergenciaComercial === 'Sim') tagsHtml += `<span>Diverg√™ncia</span>`;
    if(client.sistemaanterior === 'Sim') tagsHtml += `<span>Sistema Anterior</span>`;
    if(client.atrasoImplantacao === 'Sim') tagsHtml += `<span>Atraso</span>`;

    card.innerHTML = `
      <strong>${client.name}</strong><br>
      Integrantes: ${client.members}<br>
      In√≠cio: ${client.start} | Fim: ${client.end}<br>
      <div class="card-block"><strong>üé´ Tickets:</strong><br>${client.tickets.replace(/\n/g,'<br>')}</div>
      <div class="card-tags">${tagsHtml}</div>
      <div class="card-block"><strong>üìù Observa√ß√µes:</strong><br>${client.observacoes.replace(/\n/g,'<br>') || '-'}</div>
      <div class="card-block"><strong>üí° Trativa:</strong><br>${client.trativa.replace(/\n/g,'<br>') || '-'}</div>
      Implantador: ${client.implantador || '-'}<br>
      <button class='delete-btn' onclick='event.stopPropagation(); deleteClient(${client.id})'>Excluir Cliente</button>
    `;
    document.getElementById(client.column).appendChild(card);
  });
}

renderClients();
</script>
</body>
</html>
